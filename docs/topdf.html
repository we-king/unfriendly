<!DOCTYPE html>
<html>

<head>
    <title>图片转PDF</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="initial-scale=1.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.2/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.3.1/jspdf.umd.min.js"></script>
</head>

<body>
    <div>
        <input type="file" id="image-input" accept="image/*" />
        <input type="password" id="password" placeholder="可以设置密码" />
    </div>
    <div>
        <button id="convert-btn" onclick="convertImageToPdf()">转换为PDF</button>
    </div>
    <div>
        <img id="preview" src="" alt="" style="width: 100%;">
    </div>
    <script>
        function convertImageToPdf() {
            var img = document.getElementById('preview');
            var pwd = document.getElementById('password');
            var fileInput = document.getElementById('image-input');
            var file = fileInput.files[0];
            if (!file) {
                alert('请先选择一张图片。');
                return;
            }

            var reader = new FileReader();
            reader.onload = function (e) {
                img.src = e.target.result;
                img.onload = function () {
                    // 使用html2canvas将图片转换为canvas
                    html2canvas(img, { scale: window.devicePixelRatio, dpi: 450 }).then(canvas => {
                        var imgData = canvas.toDataURL('image/jpeg');
                        // 创建PDF文档
                        var pdf = new jspdf.jsPDF({
                            orientation: canvas.width > canvas.height ? 'landscape' : 'portrait',
                            unit: 'px',
                            format: [canvas.width, canvas.height],
                            encryption: (pwd.value && pwd.value.length > 0) ? {
                                userPassword: pwd.value,
                                ownerPassword: pwd.value,
                                userPermissions: ["copy"]
                            } : {}
                        });

                        // 将canvas图像添加到PDF
                        pdf.addImage(imgData, 'JPEG', 10, 10, canvas.width - 20, canvas.height - 20);

                        // 保存PDF文件
                        pdf.save("download.pdf");
                    });
                };
            };
            reader.readAsDataURL(file);
        }
    </script>
</body>

</html>